<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>autodb Market example</title>
  <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script>
  <script src="../host.js"></script>
</head>
<body>
  <h2 style="margin-block-end: 0;"><span style="display:inline-block; width:20px"></span>AutoDB Market Example</h2>
  <div id="phantom" class="card" style="display: none;">
    <img class="pro-img" width="320px" height="180px" src="#" alt="product"/>
    <b class="pro-name" style="font-size: 14pt;">Normal</b>
    <div class="price-div" style="float:right;">$<span class="price">39.99</span></div>
    <br>
    <span class="comments" style="font-size: 12pt;">asdf</span>
  </div>
  <style>
    .card{
      display:inline-block;
      min-width: 320px;
      min-height: 180px;
      margin: 20px;
      padding: 1em;
      box-shadow: 2px 2px 10px #cccccc;
      border-radius: 5px; 
      line-height: 1.5em;  
    }
    .pro-img {
      display: block;
      width:320px;
      height:180px;
      background-color: #cccccc;
      margin-bottom: 10px;
    }
  </style>
  <script>
    var raw = $("#phantom");  
    var getProApi=getApiAddress("7a52aefa111f995b3236cefded7d9152a703ea2df4b06539f43e8d2a22408ecf");
    var getPicApi=getApiAddress("db77c0a9acd7dc5fb55dd5a6ad588dffb0141c0165337fb40507a0891a97f462");
  </script>

  <script>
    function generateCard(data, key) {
      /*data: {
        id:id;
        name:name;
        price:price;
        comment:comment;
      }*/
      var card = raw.clone();
      card.attr("id", key);
      card.css("display", "inline-block");
      card.find(".pro-name").html(data.name);
      card.find(".price").html(data.price);
      card.find(".comments").html(data.comments);
      card.appendTo($("body"));
      $.ajax(
        {
          url:getPicApi,
          method:"POST",
          data: "{\"id\":"+data.id+"}",
          dataType: "text",
          success: function(data) {
            try {
              card.find(".pro-img").attr("src", JSON.parse(data).result[1][0]);
            } catch (_){
              console.log(data);
            }
          },
          error: function(xhr) {
            console.log(xhr.responseText);
          }
        }
      )
    }

    function getProducts() {
      $.ajax({
        url:getProApi,
        method:"POST",
        data:"",
        dataType:"text",
        success: function(data) {
          var datas = JSON.parse(data).result;
          var l = datas.length;
          for (var i=1; i<l; i++) {
            var cardData = {
              id: datas[i][0],
              name: datas[i][1],
              price: datas[i][2],
              comments: datas[i][3]
            }
            generateCard(cardData, "card-"+i);
          }
        },
        error: function(xhr) {
          console.log(xhr.responseText);
        }
      });
    }

    getProducts();
  </script>

</body>